{
  "title": "Basic CI/CD Demo",
  "cells": [
    {
      "type": "code",
      "language": "sh",
      "data": "# oc-cluster up _PROFILENAME_ --image=\"registry.access.redhat.com/openshift3/ose\" --version=v3.4.1.10 --public-hostname 192.168.1.27\noc-cluster up _PROFILENAME_ --image=\"registry.access.redhat.com/openshift3/ose\" --version=v3.4.1.10\noc login -u system:admin\noc project default\noc adm policy add-cluster-role-to-user cluster-admin developer\noc adm policy add-cluster-role-to-user cluster-admin admin\n# Demo from https://github.com/OpenShiftDemos/openshift-cd-demo\n# NB: Gogs etc. is ephemeral - everything lost after you brought the cluster down!\n# cd => git clone dir\n# git clone https://github.com/OpenShiftDemos/openshift-cd-demo\n# w/ workaround:\ngit clone https://github.com/karstengresch/openshift-cd-demo.git\ncd openshift-cd-demo\n# Admin permissions as above!\noc login -u developer\noc new-project dev --display-name=\"Tasks - Dev\"\noc new-project stage --display-name=\"Tasks - Stage\"\noc new-project cicd --display-name=\"CI/CD\"\n\noc policy add-role-to-user edit system:serviceaccount:cicd:default -n dev\noc policy add-role-to-user edit system:serviceaccount:cicd:default -n stage\noc policy add-role-to-user edit system:serviceaccount:cicd:default -n cicd\noc process -f cicd-template.yaml -v DEV_PROJECT=dev -v STAGE_PROJECT=stage | oc create -f - -n cicd\n\n# Now go to the Jenkins console and add to the pipeline config:\n# env.DEV_PROJECT = 'dev'\n# env.STAGE_PROJECT = 'stage'\n\n# Needed for later stage processing, otherwise you get 'error: You are not a member of project \"dev\".'\noc adm policy add-role-to-user admin system:serviceaccount:cicd:jenkins -n stage\noc adm policy add-role-to-user admin system:serviceaccount:cicd:jenkins -n dev\noc adm policy add-role-to-user admin system:serviceaccount:cicd:jenkins -n cicd\n# (Re-)create image streams - if not done through the oc-cluster plugin\noc login -u system:admin\noc delete is --all -n openshift\noc create -f https://raw.githubusercontent.com/openshift/origin/master/examples/image-streams/image-streams-rhel7.json -n openshift\noc create -f https://raw.githubusercontent.com/jboss-openshift/application-templates/master/jboss-image-streams.json -n openshift\n# Wait until Gogs is available. Here, clone\n# https://github.com/OpenShiftDemos/openshift-tasks.git\n# into Gogs and follow the instructions from the demo script at https://github.com/OpenShiftDemos/openshift-cd-demo"
    }
  ]
}